local ReplicatedStorage = game:GetService("ReplicatedStorage")
                                            local Workspace = game:GetService("Workspace")
                                            local Players = game:GetService("Players")
                                            local Lighting = game:GetService("Lighting")

                                            local plr = Players.LocalPlayer

                                            local function isNight()
                                                local time = tostring(Lighting.TimeOfDay)
                                                local hour = tonumber(time:split(":")[1])
                                                return hour >= 18 or hour < 5
                                            end

                                            local function toTarget(currentPosition, targetPosition, targetCFrame)
                                                local character = plr.Character
                                                if character and character:FindFirstChild("HumanoidRootPart") then
                                                    character.HumanoidRootPart.CFrame = targetCFrame
                                                end
                                            end

                                            local function CollectBlueGear()
                                                print("Collecting Blue Gear...")
                                            end

                                            local function HopServer()
                                                print("Hopping to another server...")
                                            end

                                            local function PullLever()
                                                if not ReplicatedStorage.Remotes.CommF_:InvokeServer("CheckTempleDoor") then
                                                    if Workspace.Map:FindFirstChild("MysticIsland") and isNight() then
                                                        local v213 = ReplicatedStorage.Remotes.CommF_:InvokeServer("RaceV4Progress", "Check")
                                                        if v213 == 1 then
                                                            ReplicatedStorage.Remotes.CommF_:InvokeServer("RaceV4Progress", "Begin")
                                                        elseif v213 == 2 then
                                                            local targetPosition = Vector3.new(2956.78, 2281.85, -7217.63)
                                                            local targetCFrame = CFrame.new(targetPosition)
                                                            toTarget(plr.Character.HumanoidRootPart.Position, targetPosition, targetCFrame)
                                                            if (targetPosition - plr.Character.HumanoidRootPart.Position).Magnitude < 8 then
                                                                ReplicatedStorage.Remotes.CommF_:InvokeServer("RaceV4Progress", "Teleport")
                                                            end
                                                        elseif v213 == 3 then
                                                            ReplicatedStorage.Remotes.CommF_:InvokeServer("RaceV4Progress", "Continue")
                                                        else
                                                            CollectBlueGear()
                                                        end
                                                    elseif Workspace.Map:FindFirstChild("MysticIsland") and not isNight() then
                                                        OrionLib:MakeNotification({
                                                            Name = "Banana Hub",
                                                            Content = "Waiting for Night",
                                                            Image = "rbxassetid://4483345998",
                                                            Time = 3
                                                        })
                                                        task.wait(5)
                                                    elseif not Workspace.Map:FindFirstChild("MysticIsland") and OrionLib.Flags["Pull Lever [ Hop ]"].Value then
                                                        HopServer()
                                                    end
                                                else
                                                    local lever = Workspace.Map["Temple of Time"].Lever
                                                    if lever.Lever.CFrame.Z > lever.Part.CFrame.Z + 2 or lever.Lever.CFrame.Z < lever.Part.CFrame.Z - 2 then
                                                        if (plr.Character.HumanoidRootPart.Position - lever.Part.Position).Magnitude > 10 then
                                                            toTarget(plr.Character.HumanoidRootPart.Position, lever.Part.Position, lever.Part.CFrame)
                                                        else
                                                            fireproximityprompt(lever.Prompt.ProximityPrompt, 1)
                                                        end
                                                    else
                                                        OrionLib:MakeNotification({
                                                            Name = "Banana Hub",
                                                            Content = "Pull Lever Complete",
                                                            Image = "rbxassetid://4483345998",
                                                            Time = 2
                                                        })
                                                    end
                                                end
                                            end

                                            spawn(function()
                                                while task.wait() do
                                                    pcall(function()
                                                        PullLever()
                                                    end)
                                                end
                                            end)
